<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dental Molas - Sistema de Pacientes - Periodoncia</title>

  <link rel="icon" type="image/png" href="favicon.png"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
  <link href="styles.css" rel="stylesheet">
</head>
<body class="theme-dark">
  <!-- Header -->
  <header class="app-header">
    <div class="container header-inner">
      <div class="brand">
        <img src="logoprincipal.png" alt="Dental Molas" class="brand-logo"/>
        <h1 class="brand-title">Sistema de Pacientes - Periodoncia</h1>
      </div>
      <div class="header-actions">
        <span id="userEmail" class="user-email d-none"></span>
        <button id="btnLogout" class="btn btn-outline-light d-none">
          <i class="fa-solid fa-right-from-bracket me-1"></i> Salir
        </button>
        <button id="btnDashboard" class="btn btn-outline-light">
          <i class="fa-solid fa-chart-line me-1"></i> Dashboard
        </button>
        <button id="btnAgregar" class="btn btn-light text-dark">
          <i class="fa-solid fa-user-plus me-1"></i> Agregar
        </button>
      </div>
    </div>
  </header>

  <!-- AUTH OVERLAY -->
  <div id="authOverlay" class="auth-overlay" style="display:flex;">
    <div class="auth-card">
      <div class="text-center mb-3">
        <img src="logoprincipal.png" alt="Dental Molas" height="48">
      </div>
      <h5 class="mb-3 text-center">Acceso</h5>

      <div class="mb-2">
        <label class="form-label">Email</label>
        <input id="loginEmail" type="email" class="form-control" placeholder="usuario@ejemplo.com" autocomplete="username">
      </div>

      <div class="mb-2">
        <label class="form-label">Contraseña</label>
        <input id="loginPassword" type="password" class="form-control" placeholder="••••••••" autocomplete="current-password">
      </div>

      <div class="form-check mb-2">
        <input id="rememberMe" class="form-check-input" type="checkbox" checked>
        <label class="form-check-label" for="rememberMe">Mantener sesión iniciada</label>
      </div>

      <div class="d-flex justify-content-between align-items-center mb-2">
        <a href="#" id="linkReset" class="auth-link">¿Olvidaste la contraseña?</a>
      </div>

      <div id="authInfo" class="alert alert-success py-2 d-none"></div>
      <div id="authError" class="alert alert-danger py-2 d-none"></div>

      <button id="btnLogin" class="btn btn-brand w-100 mt-1">Ingresar</button>
      <div class="mt-3 small text-muted text-center">
        Solo usuarios autorizados.
      </div>
    </div>
  </div>

  <!-- Main -->
  <main class="container py-4">
    <!-- Buscador -->
    <div class="mb-3">
      <input id="searchMain" class="form-control search" placeholder="Buscar paciente por nombre o teléfono" autocomplete="off" />
    </div>

    <!-- Filtros fila 1: Dx izquierda, Recordatorio derecha -->
    <div class="d-flex align-items-center gap-3 flex-wrap mb-2">
      <div class="d-flex align-items-center gap-2">
        <span class="filter-label">Diagnóstico de encía:</span>
        <div id="filterDx" class="btn-group btn-group-sm" role="group" aria-label="Filtro diagnóstico encía">
          <button type="button" class="btn" data-dx="">Todos</button>
          <button type="button" class="btn" data-dx="sano">Sano</button>
          <button type="button" class="btn" data-dx="gingivitis">Gingivitis</button>
          <button type="button" class="btn" data-dx="periodontitis">Periodontitis</button>
        </div>
      </div>

      <div class="d-flex align-items-center gap-2 ms-auto justify-content-end">
        <span class="filter-label">Recordatorio:</span>
        <div id="sortRec" class="btn-group btn-group-sm" role="group" aria-label="Orden recordatorio">
          <button type="button" class="btn" data-sort="prox">Próximos</button>
          <button type="button" class="btn" data-sort="lej">Lejanos</button>
        </div>
      </div>
    </div>

    <!-- Filtros fila 2: Alfabético -->
    <div class="d-flex align-items-center gap-2 flex-wrap mb-3">
      <span class="filter-label">Inicial:</span>
      <div id="alphaBar" class="d-flex flex-wrap gap-1">
        <button type="button" class="btn btn-sm btn-outline-secondary" data-alpha="">Todos</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="a">A</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="b">B</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="c">C</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="d">D</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="e">E</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="f">F</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="g">G</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="h">H</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="i">I</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="j">J</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="k">K</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="l">L</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="m">M</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="n">N</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="o">O</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="p">P</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="q">Q</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="r">R</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="s">S</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="t">T</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="u">U</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="v">V</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="w">W</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="x">X</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="y">Y</button>
        <button class="btn btn-sm btn-outline-secondary" data-alpha="z">Z</button>
      </div>
    </div>

    <!-- KPIs -->
    <div class="row g-3 mb-3">
      <div class="col-6 col-md-3"><div class="card card-kpi"><div class="card-body d-flex justify-content-between"><span class="label">Total</span><span id="counterTotal" class="kpi">0</span></div></div></div>
      <div class="col-6 col-md-3"><div class="card card-kpi"><div class="card-body d-flex justify-content-between"><span class="label">Con recordatorio</span><span id="counterConRec" class="kpi">0</span></div></div></div>
      <div class="col-6 col-md-3"><div class="card card-kpi"><div class="card-body d-flex justify-content-between"><span class="label">Próx. 7 días</span><span id="counterProx7" class="kpi">0</span></div></div></div>
      <div class="col-6 col-md-3"><div class="card card-kpi"><div class="card-body d-flex justify-content-between"><span class="label">Vencidos</span><span id="counterVencidos" class="kpi">0</span></div></div></div>
    </div>

    <!-- Tabla -->
    <div class="table-responsive">
      <table class="table table-hover align-middle" id="tablaPacientes">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Teléfono</th>
            <th>Mantenimiento</th>
            <th>Dx Encía</th>
            <th>Recordatorio</th>
            <th style="width:320px;">Acciones</th>
          </tr>
        </thead>
        <tbody><!-- filas dinámicas --></tbody>
      </table>
    </div>
  </main>

  <!-- Modal Agregar/Editar -->
  <div class="modal fade" id="modalPaciente" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Agregar Paciente</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="formPaciente" autocomplete="off">
            <div class="mb-3">
              <label class="form-label">Nombre</label>
              <input type="text" class="form-control" id="nombre" required>
            </div>

            <div class="mb-3">
              <label class="form-label">Teléfono</label>
              <div class="input-group">
                <span class="input-group-text">595</span>
                <input type="tel" class="form-control" id="telefono" placeholder="Ej.: 981885999" inputmode="numeric" required>
              </div>
              <div class="form-text">Escribe el número <b>sin 0 ni 595</b>. Ej.: 981885999.</div>
            </div>

            <div class="mb-3">
              <label class="form-label">Fecha de ingreso</label>
              <input type="date" class="form-control" id="fechaBase">
            </div>

            <div class="mb-3">
              <label class="form-label">Frecuencia de mantenimiento</label>
              <select class="form-select" id="mantenimiento" required>
                <option value="1">1 mes</option>
                <option value="3">3 meses</option>
                <option value="6">6 meses</option>
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label">Fecha Recordatorio</label>
              <input type="text" class="form-control" id="fechaRecordatorioDDMMAAAA" readonly>
              <input type="hidden" id="fechaRecordatorioISO">
            </div>

            <div class="mb-3">
              <label class="form-label">Hora Recordatorio</label>
              <input type="time" class="form-control" id="horaRecordatorio" value="09:00">
            </div>
          </form>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-brand" id="guardarPaciente">Guardar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Odontograma (edición) -->
  <div class="modal fade" id="modalOdonto" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Odontograma</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <div class="row align-items-center g-2 mb-3">
            <div class="col-auto">
              <span class="fw-semibold">Diagnóstico de la encía:</span>
            </div>
            <div class="col d-flex flex-wrap gap-3">
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="dxEncia" id="dx-encia-sano" value="sano" checked>
                <label class="form-check-label" for="dx-encia-sano">Sano</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="dxEncia" id="dx-encia-gingivitis" value="gingivitis">
                <label class="form-check-label" for="dx-encia-gingivitis">Gingivitis</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="dxEncia" id="dx-encia-periodontitis" value="periodontitis">
                <label class="form-check-label" for="dx-encia-periodontitis">Periodontitis</label>
              </div>
            </div>
          </div>

          <div id="odontoNoFile" class="alert alert-warning d-none"></div>
          <iframe id="odontoFrame" style="width:100%;height:700px;border:0;display:none"></iframe>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          <button type="button" class="btn btn-brand" id="guardarOdonto">Guardar cambios</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal FICHA (ver información) -->
  <div class="modal fade" id="modalFicha" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Ficha — <span id="fichaNombre"></span></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <ul class="nav nav-pills mb-3" id="fichaTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="tab-datos-link" data-bs-toggle="pill" data-bs-target="#tabDatos" type="button" role="tab">Datos</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="tab-odonto-link" data-bs-toggle="pill" data-bs-target="#tabOdontoFicha" type="button" role="tab">Odontograma</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="tab-trat-link" data-bs-toggle="pill" data-bs-target="#tabTrat" type="button" role="tab">Tratamientos</button>
            </li>
          </ul>

          <div class="tab-content">
            <!-- Datos -->
            <div class="tab-pane fade show active" id="tabDatos" role="tabpanel">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="list-group">
                    <div class="list-group-item d-flex justify-content-between">
                      <span class="fw-semibold">Nombre</span><span id="fNombre"></span>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                      <span class="fw-semibold">Teléfono</span>
                      <span>
                        <span id="fTelefono"></span>
                        <a id="fWhats" class="btn btn-success btn-sm ms-2" target="_blank" rel="noopener" title="WhatsApp">
                          <i class="fa-brands fa-whatsapp"></i>
                        </a>
                      </span>
                    </div>
                    <div class="list-group-item d-flex justify-content-between">
                      <span class="fw-semibold">Fecha ingreso</span><span id="fIngreso"></span>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="list-group">
                    <div class="list-group-item d-flex justify-content-between">
                      <span class="fw-semibold">Mantenimiento</span><span id="fMant"></span>
                    </div>
                    <div class="list-group-item d-flex justify-content-between">
                      <span class="fw-semibold">Dx encía</span><span id="fDx"></span>
                    </div>
                    <div class="list-group-item d-flex justify-content-between">
                      <span class="fw-semibold">Recordatorio</span><span id="fRecordatorio"></span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Odontograma (solo visualización) -->
            <div class="tab-pane fade" id="tabOdontoFicha" role="tabpanel">
              <div id="fichaOdontoWarn" class="alert alert-warning d-none"></div>
              <iframe id="fichaOdontoFrame" style="width:100%;height:700px;border:0;display:none"></iframe>
            </div>

            <!-- Tratamientos -->
            <div class="tab-pane fade" id="tabTrat" role="tabpanel">
              <form id="formTrat" class="row g-2 align-items-end mb-3">
                <div class="col-md-3">
                  <label class="form-label">Fecha</label>
                  <input type="date" id="tratFecha" class="form-control">
                </div>
                <div class="col-md-7">
                  <label class="form-label">Detalle</label>
                  <input type="text" id="tratDetalle" class="form-control" placeholder="Ej.: Caries en 21">
                </div>
                <div class="col-md-2">
                  <button type="button" id="btnAddTrat" class="btn btn-brand w-100">Agregar</button>
                </div>
              </form>
              <div id="tratList" class="list-group"></div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Dashboard -->
  <div class="modal fade" id="modalDashboard" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Dashboard</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3 mb-3">
            <div class="col-md-3"><div class="card card-kpi"><div class="card-body d-flex justify-content-between"><span class="label">Total</span><span id="kpiTotal" class="kpi">0</span></div></div></div>
            <div class="col-md-3"><div class="card card-kpi"><div class="card-body d-flex justify-content-between"><span class="label">Con recordatorio</span><span id="kpiConRec" class="kpi">0</span></div></div></div>
            <div class="col-md-3"><div class="card card-kpi"><div class="card-body d-flex justify-content-between"><span class="label">Próx. 7 días</span><span id="kpiProx7" class="kpi">0</span></div></div></div>
            <div class="col-md-3"><div class="card card-kpi"><div class="card-body d-flex justify-content-between"><span class="label">Vencidos</span><span id="kpiVencidos" class="kpi">0</span></div></div></div>
          </div>
          <div class="row g-3">
            <div class="col-md-4"><div class="card"><div class="card-header">Dx de encía</div><div class="card-body"><canvas id="chartDxEncia"></canvas></div></div></div>
            <div class="col-md-4"><div class="card"><div class="card-header">Distribución por mantenimiento</div><div class="card-body"><canvas id="chartMantenimiento"></canvas></div></div></div>
            <div class="col-md-4"><div class="card"><div class="card-header">Altas (últimos 6 meses)</div><div class="card-body"><canvas id="chartAltas"></canvas></div></div></div>
          </div>
        </div>
        <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button></div>
      </div>
    </div>
  </div>

  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module" src="app.js"></script>
</body>
</html>
